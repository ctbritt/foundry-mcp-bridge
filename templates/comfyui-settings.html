<form class="eci-settings">
  <section class="eci-block">
    <h2 class="eci-title">Map Generation Service</h2>
    <p class="eci-note">
      Configure your AI-powered battlemap creation service. Choose between local ComfyUI or RunPod serverless for faster cloud-based generation.
    </p>
  </section>

  <hr class="eci-divider"/>

  <section class="eci-block eci-settings-block">
    <h3 class="eci-subtitle">Service Type</h3>

    <div class="form-group">
      <label for="serviceType">
        <strong>Map Generation Backend</strong>
      </label>
      <select name="serviceType" id="serviceType">
        <option value="local" {{#if (eq serviceType "local")}}selected{{/if}}>Local ComfyUI</option>
        <option value="runpod" {{#if (eq serviceType "runpod")}}selected{{/if}}>RunPod Serverless</option>
      </select>
      <p class="notes">Local ComfyUI runs on your machine. RunPod Serverless uses cloud GPUs for faster generation.</p>
    </div>
  </section>

  <hr class="eci-divider"/>

  <section class="eci-block" id="local-service-section" style="display: {{#if (eq serviceType 'local')}}block{{else}}none{{/if}}">
    <h3 class="eci-subtitle">Local ComfyUI Status</h3>
    <div class="eci-status-container">
      <div class="eci-status {{connectionStatus}}" id="connection-status">
        <span id="status-text">{{connectionStatusText}}</span>
      </div>
      <div class="eci-controls">
        <button type="button" class="eci-btn check" id="check-status-btn">
          <i class="fas fa-sync"></i> Check Status
        </button>
        <button type="button" class="eci-btn start" id="start-service-btn">
          <i class="fas fa-play"></i> Start Service
        </button>
        <button type="button" class="eci-btn stop" id="stop-service-btn">
          <i class="fas fa-stop"></i> Stop Service
        </button>
      </div>
    </div>
  </section>

  <section class="eci-block eci-settings-block" id="runpod-config-section" style="display: {{#if (eq serviceType 'runpod')}}block{{else}}none{{/if}}">
    <h3 class="eci-subtitle">RunPod Configuration</h3>

    <div class="form-group">
      <label for="runpodEndpoint">
        <strong>RunPod Endpoint ID</strong>
      </label>
      <input type="text" name="runpodEndpoint" id="runpodEndpoint" value="{{runpodEndpoint}}" placeholder="e.g., nx9harqyfwbb3j" />
      <p class="notes">Your RunPod serverless endpoint ID (found in RunPod dashboard)</p>
    </div>

    <div class="form-group">
      <label for="runpodApiKey">
        <strong>RunPod API Key</strong>
      </label>
      <input type="password" name="runpodApiKey" id="runpodApiKey" value="{{runpodApiKey}}" placeholder="rpa_..." />
      <p class="notes">Your RunPod API key (kept secure, never shared)</p>
    </div>
  </section>

  <hr class="eci-divider"/>

  <section class="eci-block eci-settings-block">
    <h3 class="eci-subtitle">General Settings</h3>

    <label class="eci-check" id="auto-start-check" style="display: {{#if (eq serviceType 'local')}}block{{else}}none{{/if}}">
      <input type="checkbox" name="autoStartService" {{#if autoStartService}}checked{{/if}} />
      <span>
        <strong>Auto-start Map Generation Service</strong> â€” Automatically start ComfyUI when Foundry loads.
      </span>
    </label>

    <div class="form-group">
      <label for="mapGenQuality">
        <strong>Generation Quality</strong>
      </label>
      <select name="mapGenQuality" id="mapGenQuality">
        <option value="low" {{#if (eq mapGenQuality "low")}}selected{{/if}}>Low (8 steps, fastest)</option>
        <option value="medium" {{#if (eq mapGenQuality "medium")}}selected{{/if}}>Medium (20 steps, balanced)</option>
        <option value="high" {{#if (eq mapGenQuality "high")}}selected{{/if}}>High (35 steps, best quality)</option>
      </select>
      <p class="notes">Higher quality = better detail but slower generation. Generation time depends on your GPU.</p>
    </div>
  </section>

  <hr class="eci-divider"/>

  <div class="form-footer">
    <button type="submit" class="eci-btn"><i class="fas fa-save"></i> Apply Settings</button>
  </div>
</form>